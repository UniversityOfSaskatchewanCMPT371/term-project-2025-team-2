import{r as a,j as e,k as P,a as F,m as V,n as G,o as K,R as O,u as m,T as B,l as S}from"./index-CRrn2U-l.js";import{F as Y}from"./CheckCircleIcon-BWWj1ZLu.js";function Z({title:s,titleId:o,...h},l){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":o},h),s?a.createElement("title",{id:o},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"}))}const Q=a.forwardRef(Z);function ee({title:s,titleId:o,...h},l){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":o},h),s?a.createElement("title",{id:o},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5"}))}const te=a.forwardRef(ee);function ae({title:s,titleId:o,...h},l){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":o},h),s?a.createElement("title",{id:o},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))}const se=a.forwardRef(ae);function re({tagId:s,tagName:o,tagVR:h="",onUpdateValue:l,isPendingDelete:g=!1,pendingValue:p}){const[C,v]=a.useState(!1),[w,j]=a.useState(o),[y,d]=a.useState(o);a.useEffect(()=>{p!==void 0&&d(p)},[p]);const i=u=>{d(u.target.value)},n=()=>{j(y),l(s,y,!1),v(!1)},N=()=>{g?l(s,w,!1):l(s,"",!0)},r=g?"bg-red-100 opacity-50 hover:bg-red-400 text-red-500":p!==void 0&&p!==o?"bg-yellow-100 hover:bg-yellow-400 text-yellow-700":"bg-base-100 hover:bg-blue-600";return e.jsxs("tr",{className:r,children:[e.jsx("td",{className:"border px-4 py-2 text-center",children:e.jsxs("div",{className:"flex-col-2 flex",children:[e.jsx("div",{children:"X"}),e.jsx("div",{children:s})]})}),e.jsx("td",{className:"border px-4 py-2",children:h}),e.jsx("td",{className:"text-wrap break-words border px-4 py-2 text-center",children:C?e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"text",className:"mr-4 w-full text-wrap break-words border border-primary",value:y,onBlur:n,onChange:i}),e.jsx(P,{className:"h-6 w-6 cursor-pointer hover:scale-110 hover:text-success",onClick:n,"data-tooltip-id":`save-tag-${s}`,"data-tooltip-content":"Save update","data-tooltip-place":"left"}),e.jsx(F,{id:`save-tag-${s}`})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:g?e.jsxs("span",{className:"text-red-500",children:[w,e.jsx("span",{className:"ml-2 text-xs italic",children:"(Pending deletion)"})]}):p!==void 0&&p!==o?e.jsxs("span",{className:"text-yellow-700",children:[p,e.jsx("span",{className:"ml-2 text-xs italic",children:"(pending)"})]}):w}),e.jsxs("div",{className:"flex",children:[!g&&e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-6 w-6 cursor-pointer hover:scale-110 hover:text-primary",onClick:()=>v(!0),"data-tooltip-id":`edit-tag-${s}`,"data-tooltip-content":"Edit tag name","data-tooltip-place":"left"}),e.jsx(F,{id:`edit-tag-${s}`})]}),g?e.jsx(G,{className:"ml-2 h-6 w-6 cursor-pointer hover:scale-110 hover:text-success",onClick:N,"data-tooltip-id":`delete-tag-${s}`,"data-tooltip-content":"Undo delete tag","data-tooltip-place":"left"}):e.jsx(K,{className:"ml-2 h-6 w-6 cursor-pointer hover:scale-110 hover:text-error",onClick:N,"data-tooltip-id":`delete-tag-${s}`,"data-tooltip-content":"Delete tag","data-tooltip-place":"left"}),e.jsx(F,{id:`delete-tag-${s}`})]})]})})]})}const ne=O.memo(({showAddTag:s,addtag:o,tagId:h,tagVR:l,setTagId:g,setTagName:p,setTagVR:C,addChanges:v,searchQuery:w,tags:j,pendingChanges:y=new Map})=>{const[d,i]=a.useState(50),n=O.useMemo(()=>{if(!w.trim())return j;const r=w.toLowerCase();return j.filter(u=>u.tagId.toLowerCase().includes(r)||u.name.toLowerCase().includes(r))},[j,w]),N=()=>{i(r=>Math.min(r+50,n.length))};return e.jsx("div",{className:"w-full p-4",children:e.jsxs("table",{className:"mb-20 w-full border text-lg text-base-content",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-wrap bg-primary",children:[e.jsx("th",{className:"w-1/5 border px-4 py-2 text-primary-content",children:"Tag ID"}),e.jsx("th",{className:"w-1/5 border px-4 py-2 text-primary-content",children:"Tag VR"}),e.jsx("th",{className:"w-3/5 border px-4 py-2 text-primary-content",children:"Tag Name"})]})}),e.jsxs("tbody",{className:"text-wrap break-words bg-base-100",children:[s?e.jsxs("tr",{children:[e.jsx("td",{className:"border px-4 py-2 text-center",children:e.jsxs("div",{className:"flex-col-2 flex",children:[e.jsx("div",{className:"mr-2",children:"X"}),e.jsx("input",{type:"text",className:"w-full",placeholder:"Tag ID",maxLength:8,onChange:r=>{g(r.target.value)}})]})}),e.jsx("td",{className:"border px-4 py-2 text-center",children:e.jsx("div",{className:"flex-col-2 flex",children:e.jsx("input",{type:"text",className:"mr-4 w-full",placeholder:"Tag VR",value:l,onChange:r=>C(r.target.value)})})}),e.jsx("td",{className:"border px-4 py-2 text-center",children:e.jsxs("div",{className:"flex-col-2 flex",children:[e.jsx("input",{type:"text",className:"mr-4 w-full",placeholder:"Tag Name",onChange:r=>p(r.target.value)}),e.jsx(Y,{"data-testid":"CheckCircleIcon",className:"h-6 w-6 cursor-pointer hover:scale-110 hover:text-success",onClick:()=>o(h,l)})]})})]}):null,n.slice(0,d).map(r=>{const u=y.get(r.tagId),D=u&&u._delete;return e.jsx(re,{tagId:r.tagId,tagName:r.name,tagVR:r.vr,onUpdateValue:v,isPendingDelete:D,pendingValue:u&&!D?u.name:void 0},r.tagId)}),d<n.length&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-2 text-center",children:e.jsxs("button",{className:"btn btn-primary btn-sm",onClick:N,children:["Load More (",n.length-d," ","remaining)"]})})}),n.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-4 text-center text-base-content",children:w?"No tags match your search query":"No tags available. Add some tags to get started."})})]})]})})});function ie(){const s=m(t=>t.setShowDictEdit),o=m(t=>t.showDictEdit),h=m(t=>t.tagDictionary),l=m(t=>t.isTagDictionaryLoaded),g=m(t=>t.loadTagDictionary),p=m(t=>t.addTagToDictionary),C=m(t=>t.updateTagInDictionary),v=m(t=>t.removeTagFromDictionary),w=m(t=>t.resetTagDictionary),j=m(t=>t.setLoadingMsg),y=m(t=>t.setLoading),d=m(t=>t.setShowAlert),i=m(t=>t.setAlertMsg),n=m(t=>t.setAlertType),[N,r]=a.useState(""),[u,D]=a.useState(""),[W,I]=a.useState(""),[L,T]=a.useState(!1),[A,E]=a.useState(""),f=a.useRef(null),[M,$]=a.useState(new Map),k=a.useRef(null);a.useEffect(()=>{l||g(),f.current||(f.current=new B,f.current.initDB())},[l,g]);const _=(t,c,b)=>{S.debug(`Adding tag change: ${t} ${c} ${b}`);const x=new Map(M);if(b)x.set(t,{tagId:t,name:"",value:"",_delete:!0});else{const R=h.find(J=>J.tagId===t);R&&x.set(t,{...R,name:c})}$(x)},q=async(t,c)=>{if(S.info(`Adding tag: ${t} ${c} ${u}`),t.length!==8||isNaN(parseInt(t))){n("alert-error"),i("Tag ID has to be 8 numbers"),d(!0);return}if(u.length<1){n("alert-error"),i("Tag Name can't be empty"),d(!0);return}await p({tagId:t,name:u,vr:c.length>0?c:"SH"})?(r(""),D(""),I(""),T(!1)):(n("alert-error"),i("Failed to add tag to dictionary"),d(!0))},U=async()=>{S.debug("Updating tag values"),T(!1);let t=0,c=0;for(const[b,x]of M.entries())x._delete?await v(b)?t++:c++:await C(x)?t++:c++;$(new Map),c===0?(i(`Updates Saved (${t} changes)`),n("alert-success")):(i(`Updates partially saved (${t} successes, ${c} failures)`),n("alert-warning")),d(!0)},H=async()=>{S.info("Exporting tag dictionary"),await U(),f.current||(f.current=new B,await f.current.initDB()),await f.current.exportTagDictionary()?(i("Tag dictionary exported successfully"),n("alert-success")):(i("Failed to export tag dictionary"),n("alert-error")),d(!0)},X=async()=>{k.current&&k.current.click()},z=async t=>{const c=t.target.files;if(!c||c.length===0)return;j("Importing tag dictionary..."),y(!0),await new Promise(x=>setTimeout(x,0));const b=c[0];if(b.type!=="application/json"&&!b.name.endsWith(".json")){n("alert-error"),i("Please select a valid JSON file"),y(!1),d(!0);return}try{f.current||(f.current=new B,await f.current.initDB());const x=await f.current.importTagDictionary(b);k.current&&(k.current.value=""),x.success?(i(`Successfully imported ${x.count} tags`),n("alert-success"),g()):(i("Failed to import tag dictionary"),n("alert-error"))}catch(x){S.error("Error during tag dictionary import:",x),i("An error occurred during import"),n("alert-error")}finally{y(!1),d(!0)}};return e.jsxs("div",{className:`fixed right-0 top-0 h-full w-3/4 transform overflow-y-auto bg-base-200/95 shadow-lg backdrop-blur-sm transition-all duration-300 ease-in-out ${o?"translate-x-0":"translate-x-full"}`,children:[e.jsxs("div",{className:"mb-5 mr-8 mt-24 flex items-center justify-between",children:[e.jsx("div",{className:"ml-4 text-xl font-bold text-blue-400",children:"Edit Tag Dictionary"}),e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"relative mr-4",children:[e.jsx("input",{type:"text",placeholder:"Search tags...",className:"input input-sm input-bordered w-64",value:A,onChange:t=>E(t.target.value)}),A&&e.jsx("button",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",onClick:()=>E(""),children:"âœ•"})]})})]}),e.jsxs("div",{className:"mb-4 flex justify-around",children:[e.jsx("button",{onClick:()=>{U(),s(!1),E(""),T(!1)},className:"rounded-full bg-success px-6 py-2.5 text-sm font-medium text-primary-content shadow-md transition-all duration-200 hover:scale-105 hover:shadow-lg disabled:bg-base-300 disabled:hover:scale-100",children:"Save"}),e.jsx("button",{onClick:()=>{T(!L)},className:"rounded-full bg-primary px-6 py-2.5 text-sm font-medium text-primary-content shadow-md transition-all duration-200 hover:scale-105 hover:shadow-lg disabled:bg-base-300 disabled:hover:scale-100",children:L?"Close Add Tag":"Add Tag to Dictionary"}),e.jsxs("div",{className:"dropdown dropdown-end mt-2 transition-all duration-200 hover:scale-105",children:[e.jsx("label",{tabIndex:0,className:"cursor-pointer rounded-full bg-secondary px-6 py-2.5 text-sm font-medium text-primary-content shadow-md transition-all duration-200 hover:scale-105 hover:shadow-lg",children:"Dictionary Options"}),e.jsxs("ul",{tabIndex:0,className:"menu dropdown-content z-[1] w-52 rounded-box bg-base-100 p-2 shadow",children:[e.jsx("li",{children:e.jsxs("a",{onClick:H,className:"text-info",children:[e.jsx(Q,{className:"mr-2 inline-block h-5 w-5"}),"Export Dictionary"]})}),e.jsx("li",{children:e.jsxs("a",{onClick:X,className:"text-info",children:[e.jsx(te,{className:"mr-2 inline-block h-5 w-5"}),"Import Dictionary"]})}),e.jsx("li",{className:"mt-2 border-t border-base-300 pt-2",children:e.jsxs("a",{onClick:async()=>{await w(),T(!1),$(new Map)},className:"text-error",children:[e.jsx(se,{className:"mr-2 inline-block h-5 w-5"}),"Reset Dictionary"]})})]})]}),e.jsx("button",{onClick:()=>{s(!1),E(""),T(!1),$(new Map)},className:"rounded-full bg-error px-6 py-2.5 text-sm font-medium text-primary-content shadow-md transition-all duration-200 hover:scale-105 hover:shadow-lg disabled:bg-base-300 disabled:hover:scale-100",children:"Cancel"}),e.jsx("input",{type:"file",ref:k,accept:".json,application/json",className:"hidden",onChange:z,"data-testid":"file-input"})]}),l?e.jsx(ne,{showAddTag:L,addtag:q,tagId:N,tagName:u,tagVR:W,setTagId:r,setTagName:D,setTagVR:I,addChanges:_,searchQuery:A,tags:h,pendingChanges:M}):e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx("div",{className:"loading loading-spinner loading-lg"})})]})}export{ie as default};
