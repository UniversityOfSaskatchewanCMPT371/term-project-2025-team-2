import{l as b,r as j,u as i,j as t,e as V,G as D,F,T as y,D as k,t as E,c as S,d as I}from"./index-BeSKqqS6.js";import{g as w}from"./DicomParserUtils-Cb_f4zEl.js";import{F as A}from"./CheckCircleIcon-Cr4tDH12.js";const L=(g,d)=>{b.debug(`Filtering rows with search term: ${d}`),b.debug(`Rows length: ${g.length}`);const a=d.toLowerCase(),f=e=>{if(!e)return[];if(Array.isArray(e))return b.debug("Filtering nested array of sequence items"),e.map(o=>{if(!(o!=null&&o.tags))return null;const m=Object.values(o.tags).filter(u=>{const p=(u.tagId??"").toString().toLowerCase(),c=(u.tagName??"").toString().toLowerCase(),N=(u.value??"").toString().toLowerCase();return p.includes(a)||c.includes(a)||N.includes(a)||n(u.value)});return m.length>0?{tags:Object.fromEntries(m.map(u=>[u.tagId,u]))}:null}).filter(o=>o!==null);if(typeof e=="object"&&e.tags){b.debug("Filtering single nested object with tags");const s=Object.values(e.tags).filter(o=>{const m=(o.tagId??"").toString().toLowerCase(),u=(o.tagName??"").toString().toLowerCase(),p=(o.value??"").toString().toLowerCase();return m.includes(a)||u.includes(a)||p.includes(a)||n(o.value)});if(s.length>0)return{tags:Object.fromEntries(s.map(o=>[o.tagId,o]))}}return null},n=e=>e?Array.isArray(e)?e.some(s=>s!=null&&s.tags?Object.values(s.tags).some(o=>{const m=(o.tagId??"").toString().toLowerCase(),u=(o.tagName??"").toString().toLowerCase(),p=(o.value??"").toString().toLowerCase();return m.includes(a)||u.includes(a)||p.includes(a)||n(o.value)}):!1):typeof e=="object"&&e.tags?Object.values(e.tags).some(s=>{const o=(s.tagId??"").toString().toLowerCase(),m=(s.tagName??"").toString().toLowerCase(),u=(s.value??"").toString().toLowerCase();return o.includes(a)||m.includes(a)||u.includes(a)||n(s.value)}):!1:!1;return j.useMemo(()=>g.map(e=>{const s=(e.tagId??"").toLowerCase(),o=(e.tagName??"").toLowerCase(),m=(e.value??"").toString().toLowerCase(),u=s.includes(a)||o.includes(a)||m.includes(a),p=n(e.value),c=p?f(e.value):null;return u?e:p&&c?{...e,value:c}:null}).filter(Boolean),[g,a])},R=(g,d,a)=>{b.debug("Creating rows for the DICOM table");const f=Object.entries(g.tags).map(([n,e])=>{var s,o;return{tagId:n,tagName:e.tagName,value:((s=a.find(m=>m.fileName===d&&m.tagId===n))==null?void 0:s.newValue)||e.value,hidden:e.hidden||!1,updated:!!((o=a.find(m=>m.fileName===d&&m.tagId===n))!=null&&o.newValue),delete:!!a.find(m=>m.fileName===d&&m.tagId===n&&m.delete)}});return a.forEach(n=>{n.add&&n.fileName===d&&f.push({tagId:n.tagId,tagName:w(n.tagId)||"Unknown",value:n.newValue,hidden:!1,updated:!1,delete:!1})}),b.debug(`Created ${f.length} rows for the DICOM table`),f},O=()=>{const g=i(d=>d.hideTagNumber);return b.debug("Rendering TableHeader component"),t.jsxDEV("thead",{children:t.jsxDEV("tr",{className:"text-wrap bg-primary",children:[g?null:t.jsxDEV("th",{className:"w-1/7 border px-4 py-2 text-primary-content",children:"Tag"},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/TableHeader.tsx",lineNumber:20,columnNumber:21},void 0),t.jsxDEV("th",{className:"w-1/4 border px-4 py-2 text-primary-content",children:"Tag Name"},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/TableHeader.tsx",lineNumber:25,columnNumber:17},void 0),t.jsxDEV("th",{className:"w-7/12 border px-4 py-2 text-primary-content",children:"Value"},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/TableHeader.tsx",lineNumber:28,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/TableHeader.tsx",lineNumber:18,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/TableHeader.tsx",lineNumber:17,columnNumber:9},void 0)},B=({searchTerm:g,onSearchChange:d})=>(b.debug("Rendering Search component"),t.jsxDEV("div",{className:"mb-4 flex items-center",children:t.jsxDEV("div",{className:"relative mr-4",children:[t.jsxDEV("input",{type:"text","data-testid":"dicom-search-input",className:"rounded border px-4 py-2",placeholder:"Search tags...",value:g,onChange:a=>d(a.target.value)},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Components/utils/Search.tsx",lineNumber:23,columnNumber:17},void 0),g&&t.jsxDEV("button",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",onClick:()=>d(""),children:"âœ•"},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Components/utils/Search.tsx",lineNumber:32,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Components/utils/Search.tsx",lineNumber:22,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Components/utils/Search.tsx",lineNumber:21,columnNumber:9},void 0)),H=({searchTerm:g,onSearchChange:d,onSave:a})=>{const f=i(c=>c.dicomData),n=i(c=>c.setTags),e=i(c=>c.addTag),s=i(c=>c.setShowAddTag),o=i(c=>c.setSidePanelVisible),m=i(c=>c.tagsToAnon),u=new y;V(a!==null,"onSave should not be empty");const p=async()=>{b.info("Auto Anonymizing tags");const c=[],N=[];for(const h of f){const l=F(h,m);for(const r of l)N.some(T=>T.tagId===r.tagId)||N.push(r)}for(const h of N){const l=await u.getTag(h.tagId.slice(1)),r=l?l.name:"Unknown Tag";c.push({tagId:h.tagId,tagName:r,newValue:h.newValue})}b.debug(`Anonymizing tags: ${c}`),n(c),o(!0)};return b.debug("Rendering TableControls component"),t.jsxDEV("div",{className:"flex-col-2 flex",children:[t.jsxDEV(B,{searchTerm:g,onSearchChange:d},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/TableControls.tsx",lineNumber:84,columnNumber:13},void 0),t.jsxDEV("div",{className:"flex-col-2 ml-4 flex",children:[t.jsxDEV("div",{children:t.jsxDEV(D,{label:"Download File",disabled:!1,onClick:a},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/TableControls.tsx",lineNumber:87,columnNumber:21},void 0)},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/TableControls.tsx",lineNumber:86,columnNumber:17},void 0),t.jsxDEV("div",{className:"ml-4",children:t.jsxDEV(D,{onClick:p,label:"Auto Anon",disabled:!1},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/TableControls.tsx",lineNumber:95,columnNumber:21},void 0)},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/TableControls.tsx",lineNumber:94,columnNumber:17},void 0),t.jsxDEV("div",{className:"ml-4",children:t.jsxDEV(D,{"data-testid":"DicomAddTag",onClick:()=>s(!e),label:e?"Close Add Tag":"Add Tag",disabled:!1},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/TableControls.tsx",lineNumber:103,columnNumber:21},void 0)},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/TableControls.tsx",lineNumber:102,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/TableControls.tsx",lineNumber:85,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/TableControls.tsx",lineNumber:83,columnNumber:9},void 0)},M=()=>t.jsxDEV("tr",{children:t.jsxDEV("td",{colSpan:3,className:"border px-4 py-2 text-center",children:"No matching tags found"},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/EmptyTableRow.tsx",lineNumber:13,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/EmptyTableRow.tsx",lineNumber:12,columnNumber:5},void 0),$=()=>{const[g,d]=j.useState(""),[a,f]=j.useState(""),[n,e]=j.useState(""),s=i(r=>r.setNewTagValues),o=i(r=>r.setShowAlert),m=i(r=>r.setAlertMsg),u=i(r=>r.setShowAddTag),p=i(r=>r.files),c=i(r=>r.currentFileIndex),N=i(r=>r.setAlertType),h=(r,T,x)=>{if(b.debug(`Adding new tag with: ${r}, ${T}`),r.length!==8||isNaN(parseInt(r))){b.debug(`New tag ID is not 8 numbers: ${r}`),N("alert-error"),m("Tag ID has to be 8 numbers"),o(!0);return}if(n.length<1){b.debug("New tag value is empty"),N("alert-error"),m("Tag Value can't be empty"),o(!0);return}if(a.length<1){b.debug("New tag name is empty"),N("alert-error"),m("Tag Name can't be empty"),o(!0);return}s({fileName:p[c].name,tagId:"X"+r,newValue:T,delete:x,add:!0}),d(""),f(""),e(""),u(!1),m("Tag: "+r+" added successfully"),N("alert-success"),o(!0)},l=r=>{const T=w("X"+r);return T||"Unknown"};return b.debug("Rendering NewTagRow component"),t.jsxDEV("tr",{children:[t.jsxDEV("td",{className:"border px-4 py-2 text-center",children:t.jsxDEV("div",{className:"flex-col-2 flex",children:[t.jsxDEV("div",{className:"mr-2",children:"X"},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/NewTagRow.tsx",lineNumber:89,columnNumber:21},void 0),t.jsxDEV("input",{type:"text",className:"w-full",placeholder:"Tag ID",maxLength:8,onChange:r=>{d(r.target.value),f(l(r.target.value))}},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/NewTagRow.tsx",lineNumber:90,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/NewTagRow.tsx",lineNumber:88,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/NewTagRow.tsx",lineNumber:87,columnNumber:13},void 0),t.jsxDEV("td",{className:"border px-4 py-2 text-center",children:t.jsxDEV("input",{type:"text",className:"w-full",placeholder:"Tag Name",disabled:!0,value:a},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/NewTagRow.tsx",lineNumber:103,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/NewTagRow.tsx",lineNumber:102,columnNumber:13},void 0),t.jsxDEV("td",{className:"border px-4 py-2 text-center",children:t.jsxDEV("div",{className:"flex-col-2 flex",children:[t.jsxDEV("input",{type:"text",className:"mr-4 w-full",placeholder:"Tag Value",onChange:r=>e(r.target.value)},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/NewTagRow.tsx",lineNumber:113,columnNumber:21},void 0),t.jsxDEV(A,{"data-testid":"CheckCircleIcon",className:"h-8 w-8 cursor-pointer text-gray-500 hover:scale-110 hover:text-success",onClick:()=>h(g,n,!1)},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/NewTagRow.tsx",lineNumber:119,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/NewTagRow.tsx",lineNumber:112,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/NewTagRow.tsx",lineNumber:111,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/NewTagRow.tsx",lineNumber:86,columnNumber:9},void 0)},U=({filteredRows:g,showHidden:d,onUpdateValue:a})=>{const f=i(e=>e.addTag),n=i(e=>e.newTagValues);return b.debug("Rendering DicomTableBody component"),t.jsxDEV("tbody",{children:[f?t.jsxDEV($,{},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/DicomTableBody.tsx",lineNumber:33,columnNumber:23},void 0):null,g.length>0?g.map((e,s)=>e.hidden&&!d?null:t.jsxDEV(k,{row:e,index:s,onUpdateValue:a,updated:e.updated},s+e.tagId+n.length,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/DicomTableBody.tsx",lineNumber:38,columnNumber:25},void 0)):t.jsxDEV(M,{},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/DicomTableBody.tsx",lineNumber:48,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/DicomTableBody.tsx",lineNumber:32,columnNumber:9},void 0)},G=()=>{const[g,d]=j.useState(""),a=i(l=>l.files),f=i(l=>l.dicomData),n=i(l=>l.currentFileIndex),e=i(l=>l.newTagValues),s=i(l=>l.clearData),o=i(l=>l.setNewTagValues),m=i(l=>l.showHiddenTags),u=a[n].name;if(Object.keys(f[n].tags).length===0)return b.error("No DICOM data available"),t.jsxDEV("div",{children:"No data available"},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/DicomTable.tsx",lineNumber:40,columnNumber:16},void 0);const p=R(f[n],u,e),c=L(p,g),N=(l,r,T)=>{o({fileName:a[n].name,tagId:l,newValue:r,delete:T,add:!1})},h=()=>{b.debug(`Updating file: ${a[n].name}`);const l=a[n].name,r=e.some(v=>v.fileName===l);b.debug(`File edited: ${r}`);const T=E(f[n].DicomDataSet,e),x=new Blob([T],{type:"application/dicom"}),C=S(l,x,r);I(C),s()};return b.debug("Rendering DICOM table"),t.jsxDEV("div",{className:"mt-8",children:[t.jsxDEV("h2",{className:"text-2xl font-semibold",children:"DICOM Tags"},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/DicomTable.tsx",lineNumber:103,columnNumber:13},void 0),t.jsxDEV(H,{searchTerm:g,onSearchChange:d,onSave:h},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/DicomTable.tsx",lineNumber:104,columnNumber:13},void 0),t.jsxDEV("table",{className:"mt-4 min-w-full table-auto border-collapse",style:{tableLayout:"fixed",width:"100%"},children:[t.jsxDEV(O,{},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/DicomTable.tsx",lineNumber:113,columnNumber:17},void 0),t.jsxDEV(U,{filteredRows:c,showHidden:m,onUpdateValue:N},void 0,!1,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/DicomTable.tsx",lineNumber:114,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/DicomTable.tsx",lineNumber:109,columnNumber:13},void 0)]},u,!0,{fileName:"/home/runner/work/term-project-2025-team-2/term-project-2025-team-2/src/Features/DicomTagTable/Components/DicomTable.tsx",lineNumber:102,columnNumber:9},void 0)};export{G as default};
