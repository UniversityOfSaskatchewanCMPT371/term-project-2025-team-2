import{u as s,s as l,l as g,i as h,e as p}from"./index-BeSKqqS6.js";const O=["X0025101B","X00431029","X0043102A","X7FE00010"],S=e=>(g.info("Parsing DICOM file: ",e.name),new Promise((a,n)=>{const t=new FileReader;t.onload=r=>{var c;if(((c=r.target)==null?void 0:c.result)instanceof ArrayBuffer)try{const i=h.parseDicom(new Uint8Array(r.target.result)),f=v(i);a(f)}catch(i){g.error("Error parsing DICOM file: ",i),n("Error parsing DICOM file: "+i)}else g.error("Invalid file format: Could not read file as ArrayBuffer."),n("Invalid file format: Could not read file as ArrayBuffer.")},t.onerror=()=>n("File reading error occurred."),t.readAsArrayBuffer(e)}));function b(e){const a=s.getState().tagDictionary;if(!s.getState().isTagDictionaryLoaded)return s.getState().loadTagDictionary(),l&&l[e]?l[e].name.replace(/([a-z])([A-Z])/g,"$1 $2").trim():"Loading...";const t=a.find(r=>r.tagId===e.slice(1));return t?t.name:"Unknown"}function I(e){const a=e.startsWith("X")?e.slice(1):e;if(l&&l[a])return l[a].vr;const n=s.getState().tagDictionary,t=s.getState().isTagDictionaryLoaded;if(t){const r=n.find(c=>c.tagId===a);if(r)return r.vr}return t||s.getState().loadTagDictionary(),"UN"}const v=e=>{g.info("Extracting DICOM tags from dataset."),g.debug("Data set:",e);const a={};return!e||!e.elements?(g.warn("Invalid DICOM dataset: No elements found."),{tags:a,DicomDataSet:e}):(Object.keys(e.elements).forEach(n=>{var m,D,y,A,T;const t=e.elements[n],r=n.toUpperCase(),c=b(r);let i=t.vr;const f=I(r);i||(i=f,g.debug(`VR not found for tag "${r}". Using VR from dictionary: ${i}`));let o;try{switch(i){case"UL":o=((m=e.uint32(n))==null?void 0:m.toString())||"N/A";break;case"OB":t.dataOffset!==void 0&&t.length!==void 0?o=((y=(D=e.byteArray)==null?void 0:D.slice(t.dataOffset,t.dataOffset+t.length))==null?void 0:y.toString())||"N/A":o="N/A";break;case"FD":o=((A=e.double(n))==null?void 0:A.toString())||"N/A";break;case"US":o=((T=e.uint16(n))==null?void 0:T.toString())||"N/A";break;default:o=e.string(n)||"N/A";break}}catch(u){g.warn(`Error reading tag "${r}" with VR "${i}":`,u),o="Error reading value",s.getState().setAlertType("alert-error"),s.getState().setAlertMsg("Error reading DICOM tag values. Some tags may not be displayed."),s.getState().setShowAlert(!0)}if(t.items&&t.items.length>0){const u=t.items.map(d=>d.dataSet?v(d.dataSet):null).filter(d=>d!==null);a[r]={tagId:r,tagName:c,value:u}}else O.includes(r)?a[r]={tagId:r,tagName:c,value:o,hidden:!0}:a[r]={tagId:r,tagName:c,value:o}}),p(Object.keys(a).length>0,"No DICOM tags found in dataset."),{tags:a,DicomDataSet:e})};export{b as g,S as p};
